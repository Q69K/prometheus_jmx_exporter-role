[Unit]
Description=prometheus jmx exporter
Requires=network-online.target
After=network-online.target

[Service]
PrivateTmp=yes
User={{ jmx_exporter_user }}
Group={{ jmx_exporter_group }}
RuntimeDirectory=jmx_exporter
Environment='JAVA_OPTS=-Dcom.sun.management.jmxremote.port={{ jmx_exporter_internal_port }} \
{% if jmx_rmi %}
    -Dcom.sun.management.jmxremote.rmi.port={{ jmx_exporter_internal_port }} \
{% endif %}
    -Dcom.sun.management.jmxremote.authenticate=false \
    -Dcom.sun.management.jmxremote=true \
    -Dcom.sun.management.jmxremote.local.only=false \
    -Dcom.sun.management.jmxremote.ssl=false'
Environment='JAVA_MEM=-Xmx{{ jmx_exporter_xmx }} -Xms{{ jmx_exporter_xms }}'
ExecStart=/bin/sh -c "/usr/bin/java $JAVA_OPTS $JAVA_MEM -jar {{ jmx_exporter_root_path }}/jmx_exporter.jar {{ jmx_exporter_port }} {{ jmx_exporter_conf_path }}/jmx_config.yml > {{ jmx_exporter_log_path }}/{{ jmx_exporter_log_file }} 2>&1"
ExecStartPost=/bin/sh -c "echo $MAINPID > /run/jmx_exporter/jmx_exporter.pid"
ExecReload=/bin/kill -HUP $MAINPID
WorkingDirectory={{ jmx_exporter_root_path }}
PIDFile=/run/jmx_exporter/jmx_exporter.pid
KillSignal=SIGTERM
SuccessExitStatus=143

[Install]
WantedBy=multi-user.target
